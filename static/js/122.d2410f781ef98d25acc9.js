webpackJsonp([122],{"0rXD":function(t,e,a){var i=a("FNyv");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("7e638fee",i,!0,{})},FNyv:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,"",""])},qVLS:function(t,e,a){"use strict";function i(t){a("0rXD")}Object.defineProperty(e,"__esModule",{value:!0});var l=(a("mtWM"),a("nSkA")),r={data:function(){return{tableData:[],query:{title:null,enable:!1,page:1,pageSize:10,tagId:null},currentObj:{title:"",videoImg:"",id:"",description:"",tagId:""},showImage:!0,dialogFormVisible:!1,formLabelWidth:"120px",allTotal:null,tagOptions:[],enableTag:!1}},methods:{getWitnessList:function(t,e){var a=this,i=this.$api.witnessList+"?page="+this.query.page+"&pageSize="+this.query.pageSize;null!=t&&(i=i+"&title="+t),null!=e&&(i=i+"&tagId="+e),l.a.get(i).then(function(t){if(0==t.data.errorCode){a.tableData=t.data.data.list,a.allTotal=t.data.data.total;for(var e in a.tableData)a.tableData[e].createTime&&(a.tableData[e].bornTime=Object(l.g)(a.tableData[e].createTime),a.tableData[e].bornTime=a.tableData[e].bornTime.slice(5,16)),-2==a.tableData[e].status&&a.tableData.splice(e,1),null!==a.tableData[e].description?-1==a.tableData[e].description.indexOf("%")?a.tableData[e].description=a.tableData[e].description:(-1==a.tableData[e].description.indexOf("+")?a.tableData[e].description=a.tableData[e].description:a.tableData[e].description=a.tableData[e].description.replace(/\+/g,"%20"),a.tableData[e].description=decodeURIComponent(a.tableData[e].description)):a.tableData[e].description=a.tableData[e].description,null!==a.tableData[e].title?-1==a.tableData[e].title.indexOf("%")?a.tableData[e].title=a.tableData[e].title:(-1==a.tableData[e].title.indexOf("+")?a.tableData[e].title=a.tableData[e].title:a.tableData[e].title=a.tableData[e].title.replace(/\+/g,"%20"),a.tableData[e].title=decodeURIComponent(a.tableData[e].title)):a.tableData[e].title=a.tableData[e].title}else t.data.errorMessage?a.errorMessage(t.data.errorMessage):a.errorMessage("操作失败")}).catch(function(t){console.log(t)})},doQuery:function(){this.getWitnessList(this.query.title,this.query.tagId)},checkQuery:function(){void 0==this.query.title||null==this.query.title||Object(l.f)(this.query.title)?this.query.enable=!1:this.query.enable=!0},openEdit:function(t){var e=this;this.showImage=!1,this.dialogFormVisible=!0,this.currentObj=t,""!==this.currentObj.tagId?this.enableTag=!1:this.enableTag=!0,setTimeout(function(){e.showImage=!0},100)},getUrl:function(t,e,a,i){this.currentObj.videoImg=t},updateRow:function(){var t={};t.id=this.currentObj.id,t.title=this.currentObj.title,t.description=this.currentObj.description,t.videoImg=this.currentObj.videoImg,t.tagId=this.currentObj.tagId,t.tagName=this.searchTagName(this.currentObj.tagId),this.updatePut(t)},updatePut:function(t){var e=this,a=this.$api.witnessUpdate;l.a.put(a,t).then(function(t){0==t.data.errorCode?(e.successMessage("操作成功"),setTimeout(function(){e.dialogFormVisible=!1,e.getWitnessList(e.query.title,e.query.tagId)},500)):t.data.errorMessage?e.errorMessage(t.data.errorMessage):e.errorMessage("操作失败")}).catch(function(t){console.log(t)})},toggleStatus:function(t,e){var a=this;l.a.put(this.$api.witnessToggle+"/"+t+"/"+e).then(function(t){0==t.data.errorCode?(a.successMessage("操作成功"),setTimeout(function(){a.getWitnessList(a.query.title,a.query.tagId)},500)):t.data.errorMessage?a.errorMessage(t.data.errorMessage):a.errorMessage("操作失败")}).catch(function(t){console.log(t)})},shiftStatus:function(t,e){var a=void 0;0==t?a=1:1==t&&(a=0),this.toggleStatus(e,a)},getPages:function(t,e){this.query.page=t,this.query.pageSize=e,this.getWitnessList(this.query.title,this.query.tagId)},getTags:function(){var t=this,e=this.$api.witnessTagList;l.a.get(e).then(function(e){0==e.data.errorCode?t.tagOptions=e.data.data:e.data.errorMessage?t.errorMessage(e.data.errorMessage):t.errorMessage("操作失败")}).catch(function(t){console.log(t)})},changeTag:function(t){-1!=t&&"-1"!=t||(t=null),this.query.tagId=t,this.query.page=1,this.query.pageSize=10,this.getWitnessList(this.query.title,this.query.tagId)},alterTag:function(t){this.currentObj.tagId=t},searchTagName:function(t){var e=void 0;for(var a in this.tagOptions)t==this.tagOptions[a].tagId&&(e=this.tagOptions[a].tagName);return e}},created:function(){this.$store.dispatch("setCollapse",!0)},mounted:function(){this.getWitnessList(null,null),this.getTags()}},s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"cms-body"},[a("div",{staticClass:"content-flex-left",staticStyle:{"margin-top":"20px",flex:"auto","margin-bottom":"20px","margin-right":"20px","margin-left":"20px"}},[a("cms-input",{attrs:{label:"标题",width:240},on:{input:t.checkQuery},model:{value:t.query.title,callback:function(e){t.$set(t.query,"title",e)},expression:"query.title"}}),t._v(" "),1==t.query.enable?a("el-button",{attrs:{type:"primary"},on:{click:t.doQuery}},[t._v("查询")]):a("el-button",{attrs:{type:"primary",disabled:""}},[t._v("查询")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeTag},model:{value:t.query.tagId,callback:function(e){t.$set(t.query,"tagId",e)},expression:"query.tagId"}},[a("el-option",{key:-2,attrs:{label:"全部",value:"-1"}}),t._v(" "),a("el-option",{key:-1,attrs:{label:"无标签项",value:"0"}}),t._v(" "),t._l(t.tagOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.tagName,value:t.tagId}})})],2)],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[a("el-table-column",{attrs:{type:"selection",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tagName",label:"标签名",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[0==e.row.status?a("span",[t._v("上线")]):t._e(),t._v(" "),1==e.row.status?a("span",[t._v("下线")]):t._e(),t._v(" "),-1==e.row.status?a("span",[t._v("审核失败")]):t._e()])}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"目击者",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述",align:"center",width:"260"}}),t._v(" "),a("el-table-column",{attrs:{prop:"bornTime",label:"发布时间",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"videoUrl",label:"目击者视频",align:"center",width:"300"},scopedSlots:t._u([{key:"default",fn:function(t){return a("div",{},[a("video",{attrs:{src:t.row.videoUrl,height:"160",controls:""}})])}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("cms-button",{attrs:{type:"edit"},on:{click:function(a){t.openEdit(e.row)}}}),t._v(" "),1==e.row.status?a("cms-button",{attrs:{type:"online"},on:{click:function(a){t.shiftStatus(e.row.status,e.row.id)}}}):t._e(),t._v(" "),0==e.row.status?a("cms-button",{attrs:{type:"offline"},on:{click:function(a){t.shiftStatus(e.row.status,e.row.id)}}}):t._e()],1)}}])})],1),t._v(" "),a("div",{staticClass:"cms-list-footer",staticStyle:{"padding-bottom":"100px"}},[a("cms-pagination",{attrs:{total:t.allTotal,pageSize:t.query.pageSize,page:t.query.page,init:!0},on:{change:t.getPages}})],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑目击者视频",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{attrs:{model:t.currentObj}},[a("el-form-item",{attrs:{label:"标题","label-width":t.formLabelWidth}},[a("el-input",{model:{value:t.currentObj.title,callback:function(e){t.$set(t.currentObj,"title",e)},expression:"currentObj.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述","label-width":t.formLabelWidth}},[a("el-input",{attrs:{disabled:""},model:{value:t.currentObj.description,callback:function(e){t.$set(t.currentObj,"description",e)},expression:"currentObj.description"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"标签","label-width":t.formLabelWidth}},[1==t.enableTag?a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.alterTag},model:{value:t.currentObj.tagId,callback:function(e){t.$set(t.currentObj,"tagId",e)},expression:"currentObj.tagId"}},t._l(t.tagOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.tagName,value:t.tagId}})})):a("el-select",{attrs:{placeholder:"请选择",disabled:""},on:{change:t.alterTag},model:{value:t.currentObj.tagId,callback:function(e){t.$set(t.currentObj,"tagId",e)},expression:"currentObj.tagId"}},t._l(t.tagOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.tagName,value:t.tagId}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"展示封面","label-width":t.formLabelWidth}},[t.showImage?a("uploader",{attrs:{default:t.currentObj.videoImg},on:{change:t.getUrl}}):t._e()],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateRow}},[t._v("确 定")])],1)],1)],1)},n=[],o={render:s,staticRenderFns:n},c=o,u=a("VU/8"),d=i,g=u(r,c,!1,d,null,null);e.default=g.exports}});