webpackJsonp([51],{spI4:function(e,t,a){"use strict";function r(e){a("tBGB")}Object.defineProperty(t,"__esModule",{value:!0});var n=a("lcoF"),i=(a("mtWM"),a("nSkA")),o=a("x1ym"),s={mixins:[n.a],data:function(){var e=o.a.required("此项必填"),t=o.a.number("只能输入数字");o.a.string("只能输入英文字母");return{strict:!0,createUserId:null,contentId:null,formList:[],formValue:{},title:"",spName:"",value1:"",info:{modelId:null},value:"",formData:[],params:this.$route.query,rules:{parentId:[e],typeId:[e,t]},publishTime:"",parentId:"",dataState:!1,isLink:!1,hasContentImg:!1,hasTitleImg:!1,channelList:[],itemList:[],topicList:[],typeList:[],groupList:[],workflowList:[],tplAll:[],chargeMap:[],contentInfo:{},isTypeImg:!1,refash:!0,props:{label:"name",children:"zones",isLeaf:"isChild",id:"id"},channelVisble:!1,selectedChannel:null,showInputList:!1,currentChannelGroup:[],ue:[],ues:"",picturePath:null,chosenSubChannelList:[],chosenSubChannelArray:[],storageId:null,poster:"",showImage:!0,showSubTree:!0}},methods:{putLiveNum:function(e,t,a){var r=this;if(Object(i.f)(t)||void 0==t)return this.errorMessage("请输入正整数"),!1;if(Object(i.f)(a)||void 0==a)return this.errorMessage("请输入正整数"),!1;var n=this.$api.contentLiveNum+"?liveId="+e+"&baseNum="+t+"&addNum="+a;i.a.put(n).then(function(e){0==e.data.errorCode||(e.data.errorMessage?r.errorMessage(e.data.errorMessage):r.errorMessage("操作失败"))}).catch(function(e){console.log(e)})},getLiveNum:function(e){"addNum"!=e.field&&"baseNum"!=e.field||this.putLiveNum(this.info.uuid,this.formValue.baseNum,this.formValue.addNum)},getUrl:function(e,t,a,r){this.formValue[t]=e,this.storageId=r,this.poster=a},ansyTree:function(e,t){if(0===e.level)return t([{name:"根目录",id:"-1"}]);1==e.level&&this.getTreeNodes(e,t,0),e.level>1&&this.getTreeNodes(e,t,e.data.id)},getTreeNodes:function(e,t,a){var r=this,n=this.$api;this.rotating=!0,i.a.get(n.contentChannel+"/"+a).then(function(e){if(r.rotating=!1,"0"==e.data.errorCode){var a=[];for(var n in e.data.data){var i={};i.id=e.data.data[n].id,i.isChild=!e.data.data[n].haveChildren,i.name=e.data.data[n].name,i.data=e.data.data,a.push(i)}return t(a)}e.data.errorMessage?r.errorMessage(e.data.errorMessage):r.errorMessage("操作失败")}).catch(function(e){r.rotating=!1})},checkChange:function(e,t,a){this.info.channelIds=this.$refs.channelTree.getCheckedKeys()},getUeditor:function(e,t){this.ue[t]=e},chooseSubChannel:function(){this.channelVisble=!1,this.info.channelIds.indexOf("-1")>=0&&this.info.channelIds.splice(0,1)},getDocTxt:function(e,t){this.ue[t].execCommand("inserthtml",e)},getEditorContent:function(e){this.formValue[e]=this.ue[e].getContent()},reset:function(){var e=this;this.showImage=!1,this.showSubTree=!1,setTimeout(function(){e.showImage=!0,e.showSubTree=!0},100),this.resetDataInfo(this.formValue),this.info.channelIds=[]},resort:function(e){for(var t=0;t<e.length-1;t++)for(var a=0;a<e.length-1-t;a++)if(e[a].priority>e[a+1].priority){var r=e[a];e[a]=e[a+1],e[a+1]=r}return e},getChannelId:function(e,t){this.routerLink("/content/list","list",e.id)},getCurrentChannel:function(e,t){void 0!=t.parent.data&&(this.selectedChannel=e.name,void 0!=t.parent.parent.data&&(this.selectedChannel=t.parent.data.name+","+e.name,void 0!=t.parent.parent.parent.data&&(this.selectedChannel=t.parent.parent.data.name+","+t.parent.data.name+","+e.name))),this.finalChannelId=e.id,this.showInputList=!1,window.localStorage.setItem("channelShowList",this.selectedChannel),window.localStorage.setItem("chosenId",this.finalChannelId)},toggleShow:function(){0==this.showInputList?this.showInputList=!0:this.showInputList=!1},back:function(){window.close()},getContentInfo:function(e){var t=this,a=this.modelId;i.a.get(this.$api.itemGet+"/"+a).then(function(a){if(t.loading=!1,"0"==a.data.errorCode){t.formList=t.resort(a.data.data).reverse();var r=void 0;for(var n in t.formList)if(7==t.formList[n].dataType&&(r=t.formList[n].field),"图片展示类型"==t.formList[n].showName&&(t.formList[n].optValue="自定义风格, 三图"),1==t.formList[n].isRequire){var i={},o=[];o.push(i),i.message="此项必填",i.required=!0,i.trigger="blur",i.validator=function(e,t,a){},t.$set(t.rules,t.formList[n].field),t.rules[t.formList[n].field]=o}e(r)}else a.data.errorMessage?t.errorMessage(a.data.errorMessage):t.errorMessage("操作失败")})},getDataInfo:function(){var e=this,t=this.contentId;i.a.get(this.$api.contentGet+"/"+t).then(function(t){if(e.loading=!1,"0"==t.data.errorCode){e.publishTime=Object(i.g)(t.data.data.publishTime),e.publishTime=e.publishTime.slice(5,16),e.modelId=t.data.data.modelId,e.title=t.data.data.title,e.spName=t.data.data.spName,e.formData=t.data.data.attr,e.createUserId=t.data.data.createUserId,e.storageId=t.data.data.storageId,e.poster=t.data.data.poster,e.chosenSubChannelArray=t.data.data.channelIds,e.info.channelIds=t.data.data.channelIds,e.info.topLevel=t.data.data.topLevel,e.info.uuid=t.data.data.uuid;var a=t.data.data.channelId;window.localStorage.setItem("chosenId",a),e.getChannel(a),e.getContentInfo(function(t){for(var a in e.formData)"图片展示类型"==e.formData[a].attrName&&("0"==e.formData[a].attrValue?e.formData[a].attrValue="自定义风格":"1"==e.formData[a].attrValue&&(e.formData[a].attrValue="三图")),e.$set(e.formValue,e.formData[a].attrName),e.formData[a].attrName==t?e.formValue[e.formData[a].attrName]=e.formData[a].attrValue.split(","):e.formValue[e.formData[a].attrName]=e.formData[a].attrValue})}else t.data.errorMessage?e.errorMessage(t.data.errorMessage):e.errorMessage("操作失败")})},getChannel:function(e){var t=this;i.a.get(this.$api.channelInfo+"/"+e).then(function(e){"0"==e.data.errorCode?(t.currentChannelGroup.push(e.data.data.name),e.data.data.parentId&&t.getChannel(e.data.data.parentId),t.currentChannelGroup=t.currentChannelGroup.reverse(),t.selectedChannel=t.currentChannelGroup.join("/")):e.data.errorMessage?t.errorMessage(e.data.errorMessage):t.errorMessage("操作失败")})},getParams:function(){var e={},t=[];for(var a in this.formValue)e.attrObj={},void 0!=this.formValue[a]&&(e.attrObj.attrName=a,this.formValue[a]instanceof Array?e.attrObj.attrValue=this.formValue[a].join(","):e.attrObj.attrValue=this.formValue[a],t.push(e.attrObj),e.attr=t);return delete e.attrObj,e.channelId=parseInt(window.localStorage.getItem("chosenId")),e.modelId=this.modelId,e.storageId=this.storageId,e.parentId=this.info.parentId,e.poster=this.poster,e.siteId=1,e.status=0,e.topLevel=this.info.topLevel,e.weight=0,e.title=this.title,e.channelIds=this.info.channelIds,e.createUserId=this.createUserId,e.id=this.contentId,e},update:function(e){for(var t=0;t<this.formList.length;t++)if(11==this.formList[t].dataType&&this.getEditorContent(this.formList[t].field),this.formList[t].isRequire&&"title"!==this.formList[t].field&&"publishTime"!==this.formList[t].field&&"spName"!==this.formList[t].field&&(void 0==this.formValue[this.formList[t].field]||""==this.formValue[this.formList[t].field]))return this.errorMessage("请补全"+this.formList[t].showName),!1;var a=this.getParams();if(isNaN(a.channelId))return this.errorMessage("请选择一个栏目"),!1;for(var r in a.attr)" 三图"==a.attr[r].attrValue?a.attr[r].attrValue="1":"自定义风格"==a.attr[r].attrValue&&(a.attr[r].attrValue="0");this.saves(e,a)},saves:function(e,t){var a=this,r=this.$api.contentUpdate;this.$refs.form;i.a.put(r,t).then(function(e){"0"==e.data.errorCode?(a.successMessage("操作成功"),setTimeout(function(){window.close()},1e3)):e.data.errorMessage?a.errorMessage(e.data.errorMessage):a.errorMessage("操作失败")})}},created:function(){this.$store.dispatch("setCollapse",!0),this.contentId=parseInt(this.params.id),this.getDataInfo();var e=window.localStorage.getItem("_site_id_param");1==this.contentId&&1==e?this.updateButtonEnable=!1:this.updateButtonEnable=!0},mounted:function(){this.finalChannelId=window.localStorage.getItem("chosenId")}},l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"cms-body flex"},[a("a",{staticClass:"cms-back",attrs:{href:"javascript:void(0)"},on:{click:e.back}}),e._v(" "),a("cms-tree",{attrs:{treeType:"page"},on:{change:e.getChannelId}}),e._v(" "),a("div",{staticClass:"cms-content-right"},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",staticClass:"cms-form",attrs:{model:e.info,rules:e.rules,"label-width":"162px"}},[a("el-form-item",{staticClass:"flex-50",attrs:{label:"选择栏目",prop:"parentId"}},[a("el-input",{staticClass:"cms-width",attrs:{value:e.selectedChannel},on:{focus:e.toggleShow}}),e._v(" "),e.showInputList?a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"triangle"}),e._v(" "),a("div",{staticClass:"input-list"},[a("cms-tree",{attrs:{treeType:"page"},on:{click:e.getCurrentChannel}})],1)]):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"flex-50",attrs:{label:"关联副栏目"}},[a("el-button",{on:{click:function(t){e.channelVisble=!0}}},[e._v("关联副栏目")])],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"选择副栏目",visible:e.channelVisble,width:"30%"},on:{"update:visible":function(t){e.channelVisble=t}}},[a("div",{staticClass:"tree-layout"},[e.showSubTree?a("div",{staticClass:"tree"},[e.refash?a("el-tree",{ref:"channelTree",attrs:{props:e.props,load:e.ansyTree,lazy:"",indent:16,"node-key":"id","default-expanded-keys":[""],"default-checked-keys":e.info.channelIds,"check-strictly":e.strict,"show-checkbox":""},on:{"check-change":e.checkChange},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{attrs:{title:r.label}},[e._v(e._s(r.label)+" "+e._s(n.id))])])}}])}):e._e()],1):e._e()]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.channelVisble=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.chooseSubChannel}},[e._v("选择")])],1)]),e._v(" "),a("el-form-item",{staticClass:"flex-100",attrs:{label:"uuid"}},[a("el-input",{attrs:{placeholder:"uuid",disabled:""},model:{value:e.info.uuid,callback:function(t){e.$set(e.info,"uuid",t)},expression:"info.uuid"}})],1),e._v(" "),e._l(e.formList,function(t,r){return a("el-form-item",{key:r,class:t.single?"flex-100":"flex-50",attrs:{label:t.showName,prop:t.field}},["spName"==t.field?a("div",[a("el-input",{attrs:{placeholder:"sp名称"},model:{value:e.spName,callback:function(t){e.spName=t},expression:"spName"}})],1):a("div",[1==t.dataType&&"title"==t.field?a("el-input",{attrs:{placeholder:t.description},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}):e._e(),e._v(" "),1==t.dataType&&"title"!==t.field?a("el-input",{attrs:{placeholder:t.description},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}}):e._e()],1),e._v(" "),2==t.dataType?a("el-input",{attrs:{placeholder:t.description},on:{blur:function(a){e.getLiveNum(t)}},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}}):e._e(),e._v(" "),3==t.dataType?a("el-input",{attrs:{placeholder:t.description,type:"number"},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}}):e._e(),e._v(" "),4==t.dataType?a("el-input",{attrs:{type:"textarea",rows:2,placeholder:t.description},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}}):e._e(),e._v(" "),5==t.dataType&&"publishTime"!=t.field?a("el-input",{attrs:{placeholder:"选择日期",disabled:""},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}}):e._e(),e._v(" "),5==t.dataType&&"publishTime"==t.field?a("el-input",{attrs:{placeholder:"选择日期",disabled:""},model:{value:e.publishTime,callback:function(t){e.publishTime=t},expression:"publishTime"}}):e._e(),e._v(" "),7==t.dataType?a("el-checkbox-group",{model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}},e._l(t.optValue.split(","),function(e,t){return a("el-checkbox",{key:t,attrs:{label:e}})})):e._e(),e._v(" "),6==t.dataType?a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}},e._l(t.optValue.split(","),function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})):e._e(),e._v(" "),8==t.dataType?a("el-radio-group",{model:{value:e.formValue[t.field],callback:function(a){e.$set(e.formValue,t.field,a)},expression:"formValue[item.field]"}},e._l(t.optValue.split(","),function(e,t){return a("el-radio",{key:t,attrs:{label:e}})})):e._e(),e._v(" "),10==t.dataType&&e.showImage&&"poster"==t.field?a("uploader",{attrs:{index:t.field,default:e.poster},on:{change:e.getUrl}}):e._e(),e._v(" "),10==t.dataType&&e.showImage&&"poster"!==t.field?a("uploader",{attrs:{index:t.field,default:e.formValue[t.field]},on:{change:e.getUrl}}):e._e(),e._v(" "),11==t.dataType?a("cms-editor",{attrs:{defaultMsg:e.formValue[t.field],index:t.field},on:{ready:e.getUeditor}}):e._e()],1)}),e._v(" "),a("div",{staticClass:"form-footer"},[e.updateButtonEnable?a("el-button",{directives:[{name:"perms",rawName:"v-perms",value:"/content/update",expression:"'/content/update'"}],attrs:{type:"primary"},on:{click:function(t){e.update(!1)}}},[e._v("修改")]):a("el-button",{attrs:{type:"primary",disabled:""}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:e.reset}},[e._v("重置")])],1)],2)],1)],1)},d=[],u={render:l,staticRenderFns:d},c=u,f=a("VU/8"),h=r,p=f(s,c,!1,h,"data-v-7a81e998",null);t.default=p.exports},szVH:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"\n.w40p[data-v-7a81e998]{\r\n  width: 35% !important;\n}\n.input-list[data-v-7a81e998] {\r\n  width: 200px;\r\n  position: relative;\r\n  display: inline-block;\r\n  height: 200px;\r\n  z-index: 10;\r\n  border-radius: 4px;\r\n  -webkit-box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);\r\n          box-shadow: 0 2px 12px 0 rgba(0,0,0,.1); \r\n  overflow: auto;\n}\n.triangle[data-v-7a81e998] {\r\n  margin-top: 10px;\r\n  margin-left: 15px;\r\n  width:0;\r\n  height:0;\r\n  border-width:0 7px 7px;\r\n  border-style:solid;\r\n  border-color:transparent transparent #333;/*透明 透明  灰*/\r\n  position:relative;\r\n  z-index: 9;\n}\n.triangle[data-v-7a81e998]::after {\r\n  content: '';\r\n  margin-left: -6px;\r\n  display: block;\r\n  width:0;\r\n  height:0;\r\n  border-style:solid;\r\n  border-width:0 6.5px 6.5px;\r\n  border-color:transparent transparent white;\n}\n.input-list>ul[data-v-7a81e998] {\r\n  width: 100%;\r\n  display: inline-block;\n}\n.has-arrow[data-v-7a81e998], .has-not-arrow[data-v-7a81e998] {\r\n  font-size: 14px;\r\n  padding: 8px 20px;\r\n  position: relative;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  color: #606266;\r\n  height: 34px;\r\n  line-height: 1.5;\r\n  -webkit-box-sizing: border-box;\r\n          box-sizing: border-box;\r\n  cursor: pointer;\r\n  outline: 0;\n}\n.has-arrow[data-v-7a81e998]:after {\r\n  content: '>';\r\n  float: right;\r\n  color: #666666;\n}\n.has-not-arrow[data-v-7a81e998]:after {\r\n  content: '>';\r\n  float: right;\r\n  color: transparent;\n}\n.bg-img[data-v-7a81e998] {\r\n  display: inline-block;\r\n  position: absolute;\r\n  width: 130px;\r\n  height: 130px;\r\n  border-radius: 6px;\r\n  background-repeat: no-repeat;\r\n  background-size: cover;\r\n  background-position: center;\n}\n.display-picture[data-v-7a81e998] {\r\n    position: relative;\r\n    overflow: hidden;\r\n    z-index: 0;\r\n    width: 100%;\r\n    background-color: #fff;\r\n    border: 1px solid #c0ccda;\r\n    border-radius: 6px;\r\n    -webkit-box-sizing: border-box;\r\n    box-sizing: border-box;\r\n    margin-top: 10px;\r\n    padding: 10px 10px 10px 90px;\r\n    height: 92px;\n}\n.display-thumb[data-v-7a81e998] {\r\n    vertical-align: middle;\r\n    display: inline-block;\r\n    width: 70px;\r\n    height: 70px;\r\n    background-color: pink;\r\n    float: left;\r\n    position: relative;\r\n    z-index: 1;\r\n    margin-left: -80px;\n}\n.display-filename[data-v-7a81e998] {\r\n    line-height: 70px;\r\n    margin-top: 0;\n}\n.delete-default[data-v-7a81e998] {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 10px;\r\n  cursor: hand;\r\n  cursor: pointer;\n}\r\n",""])},tBGB:function(e,t,a){var r=a("szVH");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("5965d899",r,!0,{})}});