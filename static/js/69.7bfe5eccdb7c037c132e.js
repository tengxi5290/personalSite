webpackJsonp([69],{"6hrI":function(e,n,t){n=e.exports=t("FZ+f")(!1),n.push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},MoOx:function(e,n,t){var s=t("6hrI");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);t("rjj0")("12247067",s,!0,{})},WYAc:function(e,n,t){"use strict";function s(e){t("MoOx")}Object.defineProperty(n,"__esModule",{value:!0});var a=t("5HJ5"),r=t("nSkA"),i={mixins:[a.a],data:function(){return{pageSize:10,page:1,ok:"启用",params:{userName:"",mobileNumber:"",enable:1,page:1,pageSize:10},tableData:[],userType:null,gridData:[],dialogTableVisible:!1,tableType:"",toggleRoles:{additionRoles:[],omitRoles:[],currentRoles:[]},totalRole:null}},methods:{showDialog:function(e,n){if(this.currentUserId=e,this.dialogTableVisible=!0,"user"==n)switch(this.tableType="role",this.userType){case"MASTER_ADMIN":case"SITE_ADMIN":case"SP_ADMIN":this.getRoleList(this.$api.userRolePermission+"/"+this.currentUserId+"?page=1&pageSize=10");break;default:console.log("others")}else if("rename"==n)switch(this.tableType="site",this.userType){case"MASTER_ADMIN":case"SP_ADMIN":this.getSites();break;default:console.log("others")}},shiftAdmin:function(e){var n=this,t={};t.userId=e.userId,t.siteUser=e.siteUser,t.siteAdmin=e.siteAdmin,t.siteId=e.siteId;var s=this.$api.userSite;r.a.post(s,t).then(function(e){"0"==e.data.errorCode?n.getSites():(e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败"),n.getSites())})},shiftSiteUser:function(e){var n=this,t={};t.userId=e.userId,t.siteUser=e.siteUser,t.siteAdmin=!1,t.siteId=e.siteId;var s=this.$api.userSite;r.a.post(s,t).then(function(e){"0"==e.data.errorCode?n.getSites():(e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败"),n.getSites())})},getSites:function(){var e=this,n=this.$api.userSiteList;r.a.get(n+"/"+this.currentUserId).then(function(n){e.loading=!1,"0"==n.data.errorCode?e.gridData=n.data.data:n.data.errorMessage?e.errorMessage(n.data.errorMessage):e.errorMessage("操作失败")})},getRoleList:function(e){var n=this;this.toggleRoles.currentRoles=[],r.a.get(e).then(function(e){if("0"==e.data.errorCode){n.gridData=e.data.data.list;for(var t in n.gridData)1==n.gridData[t].haveRole&&n.toggleRoles.currentRoles.push(n.gridData[t].id);n.totalRole=e.data.data.total}else e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败")})},getRolePages:function(e,n){this.getRoleList(this.$api.userRolePermission+"/"+this.currentUserId+"?page="+e+"&pageSize="+n)},queryEnable:function(e){this.params.enable="all"==e?"":e,this.getUserList(this.queryString())},queryInfo:function(){this.getUserList(this.queryString())},getUserList:function(e){var n=this;r.a.get(e).then(function(e){n.loading=!1,"0"==e.data.errorCode?(n.tableData=e.data.data.list,n.total=e.data.data.total):e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败")})},queryString:function(e){var n=this.$api.memberList;"page"!=e&&(this.params.page=1);for(var t in this.params)""!=this.params[t]&&(n=-1==n.indexOf("?")?n+"?"+t+"="+this.params[t]:n+"&"+t+"="+this.params[t]);return n},getPages:function(e,n){this.params.page=e,this.params.pageSize=n,this.getUserList(this.queryString("page"))},postUserRoles:function(){var e=this;this.toggleRoles.additionRoles=[],this.toggleRoles.omitRoles=[];var n=[];for(var t in this.$refs.table.data)1==this.$refs.table.data[t].haveRole&&n.push(this.$refs.table.data[t].id);for(var s in n)-1==this.toggleRoles.currentRoles.indexOf(n[s])&&this.toggleRoles.additionRoles.push(n[s]);for(var a in this.toggleRoles.currentRoles)-1==n.indexOf(this.toggleRoles.currentRoles[a])&&this.toggleRoles.omitRoles.push(this.toggleRoles.currentRoles[a]);var i=this.$api.roleUser,o=this.$api.roleUserOmit;if(this.toggleRoles.additionRoles.length>0){var l={},g=[];for(var d in this.toggleRoles.additionRoles){var u={};u.roleId=this.toggleRoles.additionRoles[d],u.userId=this.currentUserId,g.push(u)}l.userRoles=g,r.a.post(i,l).then(function(n){e.loading=!1,"0"==n.data.errorCode?(e.successMessage("操作成功"),e.dialogTableVisible=!1):n.data.errorMessage?e.errorMessage(n.data.errorMessage):e.errorMessage("操作失败")})}if(this.toggleRoles.omitRoles.length>0&&r.a.delete(o+"/"+this.currentUserId+"/"+this.toggleRoles.omitRoles.join(",")).then(function(n){e.loading=!1,"0"==n.data.errorCode?(e.successMessage("操作成功"),e.dialogTableVisible=!1):n.data.errorMessage?e.errorMessage(n.data.errorMessage):e.errorMessage("操作失败")}),0==this.toggleRoles.omitRoles.length&&0==this.toggleRoles.additionRoles.length)return this.open(),!1},shiftSingle:function(){},open:function(){this.$message({message:"没有改动",type:"warning"})}},created:function(){this.$store.dispatch("setCollapse",!0),this.siteId=window.localStorage.getItem("_site_id_param");var e=localStorage.getItem("userType");this.userType=e,this.getUserList(this.queryString())}},o=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cms-body"},[t("div",{staticClass:"cms-list-header flex-between"},[t("div",[t("el-select",{on:{change:e.queryEnable},model:{value:e.ok,callback:function(n){e.ok=n},expression:"ok"}},[t("el-option",{attrs:{label:"启用",value:"true"}}),e._v(" "),t("el-option",{attrs:{label:"禁用",value:"false"}}),e._v(" "),t("el-option",{attrs:{label:"全部",value:"all"}})],1),e._v(" "),t("cms-input",{attrs:{label:"用户名"},model:{value:e.params.userName,callback:function(n){e.$set(e.params,"userName",n)},expression:"params.userName"}}),e._v(" "),t("cms-input",{attrs:{label:"手机号码"},model:{value:e.params.mobileNumber,callback:function(n){e.$set(e.params,"mobileNumber",n)},expression:"params.mobileNumber"}}),e._v(" "),t("el-button",{on:{click:e.queryInfo}},[e._v("查询")])],1)]),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"userName",label:"用户名",align:"left"}}),e._v(" "),t("el-table-column",{attrs:{prop:"mobileNumber",label:"手机号码",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return t("div",{},[n.row.enable?t("span",[e._v("启用")]):t("span",{staticClass:"red"},[e._v("禁用")])])}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return t("div",{},["MASTER_ADMIN"==e.userType||"SITE_ADMIN"==e.userType||"SP_ADMIN"==e.userType?t("cms-button",{attrs:{type:"user"},on:{click:function(t){e.showDialog(n.row.id,"user")}}}):e._e(),e._v(" "),"MASTER_ADMIN"==e.userType||"SP_ADMIN"==e.userType?t("cms-button",{attrs:{type:"rename"},on:{click:function(t){e.showDialog(n.row.id,"rename")}}}):e._e(),e._v(" "),"USER"==e.userType?t("cms-button",{attrs:{type:"user",disabled:""}}):e._e(),e._v(" "),"USER"==e.userType?t("cms-button",{attrs:{type:"rename",disabled:""}}):e._e()],1)}}])})],1),e._v(" "),t("div",{staticClass:"cms-list-footer"},[t("cms-pagination",{attrs:{total:e.total,pageSize:e.params.pageSize,page:e.params.page,init:!0},on:{change:e.getPages}})],1),e._v(" "),t("div",{staticClass:"dialog-container"},["role"==e.tableType?t("el-dialog",{attrs:{title:"角色分配",visible:e.dialogTableVisible},on:{"update:visible":function(n){e.dialogTableVisible=n}}},[t("el-table",{key:"role",ref:"table",attrs:{data:e.gridData}},[t("el-table-column",{attrs:{align:"center",property:"haveRole",label:"选择"},scopedSlots:e._u([{key:"default",fn:function(n){return t("div",{},[t("el-checkbox",{on:{change:function(t){e.shiftSingle(n.row)}},model:{value:n.row.haveRole,callback:function(t){e.$set(n.row,"haveRole",t)},expression:"scope.row.haveRole"}})],1)}}])}),e._v(" "),t("el-table-column",{attrs:{property:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{property:"name",label:"角色名",align:"center"}})],1),e._v(" "),t("div",{staticClass:"cms-list-footer"},[t("el-button",{on:{click:e.postUserRoles}},[e._v("确定")]),e._v(" "),t("cms-pagination",{attrs:{total:e.totalRole,pageSize:e.pageSize,page:e.page,init:!1},on:{change:e.getRolePages}})],1)],1):e._e(),e._v(" "),"site"==e.tableType?t("el-dialog",{attrs:{title:"站点分配",visible:e.dialogTableVisible},on:{"update:visible":function(n){e.dialogTableVisible=n}}},[t("el-table",{key:"site",ref:"table",attrs:{data:e.gridData}},[t("el-table-column",{attrs:{property:"siteUser",label:"选择",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return t("div",{},[t("el-checkbox",{on:{change:function(t){e.shiftSiteUser(n.row)}},model:{value:n.row.siteUser,callback:function(t){e.$set(n.row,"siteUser",t)},expression:"scope.row.siteUser"}})],1)}}])}),e._v(" "),t("el-table-column",{attrs:{property:"siteName",label:"站点",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{property:"siteAdmin",label:"管理员",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return t("div",{},[n.row.siteUser?t("el-checkbox",{on:{change:function(t){e.shiftAdmin(n.row)}},model:{value:n.row.siteAdmin,callback:function(t){e.$set(n.row,"siteAdmin",t)},expression:"scope.row.siteAdmin"}}):t("el-checkbox",{attrs:{disabled:""},model:{value:n.row.siteAdmin,callback:function(t){e.$set(n.row,"siteAdmin",t)},expression:"scope.row.siteAdmin"}})],1)}}])})],1)],1):e._e()],1)],1)},l=[],g={render:o,staticRenderFns:l},d=g,u=t("VU/8"),c=s,p=u(i,d,!1,c,null,null);n.default=p.exports}});