webpackJsonp([86],{"/XBl":function(n,e,r){"use strict";function t(n){r("OQeP")}Object.defineProperty(e,"__esModule",{value:!0});var i=(r("mtWM"),r("x1ym")),a=r("lcoF"),s=r("nSkA"),o={mixins:[a.a],data:function(){var n=i.a.required("此项必填"),e=i.a.number("只能输入数字");return{firstLevel:[],checkStrict:!1,props2:{label:"name",children:"zones",isLeaf:"isChild",id:"id"},ready:!1,dataInfo:{priority:0,level:0,all:!1},rules:{name:[n],priority:[n,e],level:[n,e],all:[n]},roleAll:!0,loading:!1,role:{newRoleId:null,showTree:!1},updateId:null,treeListParent:[],defaultProps1:{children:"childrenNodes",label:"name"},page:"",chosenTreeIds:[],checkedTree:[],checkedUri:[],props:{copy:{type:Boolean,default:!1},hasContent:{type:Boolean,default:!0},treeType:""},totalChilds:[]}},methods:{nodeExpand:function(n,e,r){for(var t in e.childNodes)-1==this.checkedTree.indexOf(e.childNodes[t].data.id)&&(e.childNodes[t].checked=!1);var i=e.childNodes,a=[],s=[];for(var o in i)0==i[o].checked?a.push(i[o]):s.push(i[o]);if(a.length==i.length||s.length<i.length&&(e.checked=!1,e.indeterminate=!0),1==e.checked)for(var l in i)i[l].checked=!0},getAllLeaves:function(n){var e=[];this.totalChilds.push(n);for(var r in this.originalTree)this.originalTree[r].parentId==n&&e.push(this.originalTree[r].id);this.totalChilds=this.totalChilds.concat(e);for(var t in e)this.getAllLeaves(e[t])},ansyTree:function(n,e){if(0==n.level){for(var r=this.originalTree,t=0;t<r.length;t++)r[t].childrenNodes=[],null==r[t].parentId&&this.firstLevel.push(r[t]);var i=[];for(var a in this.firstLevel){var s={};s.id=this.firstLevel[a].id,s.isChild=!this.firstLevel[a].haveChildren,s.name=this.firstLevel[a].name,s.data=this.firstLevel,s.haveChildren=this.firstLevel[a].haveChildren,i.push(s)}return e(i)}n.level>=1&&this.getTreeNodes(n,e,n.data.id)},getUri:function(n){for(var e=void 0,r=0;r<this.originalTree.length;r++)n==this.originalTree[r].id&&(e=this.originalTree[r].uri);return e},getTreeNodes:function(n,e,r){for(var t=[],i=0;i<this.originalTree.length;i++)r==this.originalTree[i].parentId&&t.push(this.originalTree[i]);var a=[];for(var s in t){var o={};o.id=t[s].id,o.isChild=!t[s].haveChildren,o.name=t[s].name,o.data=t,o.haveChildren=t[s].haveChildren,a.push(o)}return e(a)},getDataInfo:function(n){var e=this,r=this.$api;s.a.get(r.roleGet+"/"+n).then(function(n){"0"==n.data.errorCode?(e.loading=!1,e.dataInfo=n.data.data):n.data.errorMessage?e.errorMessage(n.data.errorMessage):e.errorMessage("请求失败")}).catch(function(n){e.loading=!1})},getRole:function(n){this.dataInfo.perms=this.$refs.role.creatRoles()},reset:function(){var n=this;this.role.showTree=!1,this.firstLevel=[],this.checkedTree=[],setTimeout(function(){n.role.showTree=!0},100)},compareChange:function(n,e,r){var t=[];if("omit"==r)for(var i in n)-1==e.indexOf(n[i])&&t.push(n[i]);else if("increase"==r)for(var a=0;a<e.length;a++)-1==n.indexOf(e[a])&&t.push(e[a]);return t},update:function(){var n=this,e=[],r=this.$refs.tree.getCheckedNodes(),t=[],i=[];for(var a in r){this.getAllLeaves(r[a].id);for(var o in this.totalChilds)-1==e.indexOf(this.totalChilds[o])&&e.push(this.totalChilds[o]);t=e}for(var l in t){var d={};d.id=t[l],d.children=this.getAllChildsIds(t[l]),i.push(d)}for(var h in i)if(i[h].children.length>0){var c=this.isContained(t,i[h].children);0==c||this.array_diff(t,i[h].children)}for(var u in e)this.chosenTreeIds.push(this.getUri(e[u]));var f=escape(this.compareChange(this.checkedUri,this.chosenTreeIds,"omit").join(",")),p=escape(this.compareChange(this.checkedUri,this.chosenTreeIds,"increase").join(",")),v=this.$api.setRolePermission;s.a.put(v+"/"+this.updateId+"?adduris="+p+"&deluris="+f).then(function(e){n.loading=!1,"0"==e.data.errorCode?(n.successMessage("操作成功"),setTimeout(function(){n.routerLink("/role/list")},1e3)):e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败")}).catch(function(e){n.loading=!1}),this.dataInfo.id=this.updateId,s.a.put(this.$api.roleUpdate,this.dataInfo).then(function(e){n.loading=!1,"0"==e.data.errorCode||(n.role.newRoleId=null,n.role.showTree=!1,e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败"))}).catch(function(e){n.loading=!1})},getAllChildsIds:function(n){var e=[];for(var r in this.originalTree)this.originalTree[r].parentId==n&&e.push(this.originalTree[r].id);return e},add:function(n){var e=[],r=this.$refs.addTree.getCheckedNodes(),t=[],i=[];for(var a in r){this.getAllLeaves(r[a].id);for(var s in this.totalChilds)-1==e.indexOf(this.totalChilds[s])&&e.push(this.totalChilds[s]);t=e}for(var o in t){var l={};l.id=t[o],l.children=this.getAllChildsIds(t[o]),i.push(l)}for(var d in i)if(i[d].children.length>0){var h=this.isContained(t,i[d].children);0==h||this.array_diff(t,i[d].children)}for(var c in e)this.chosenTreeIds.push(this.getUri(e[c]));this.saveRole(n)},array_diff:function(n,e){for(var r=0;r<e.length;r++)for(var t=0;t<n.length;t++)n[t]==e[r]&&(n.splice(t,1),t-=1);return n},isContained:function(n,e){if(!(n instanceof Array&&e instanceof Array))return!1;if(n.length<e.length)return!1;for(var r=n.toString(),t=0,i=e.length;t<i;t++)if(-1==r.indexOf(e[t]))return!1;return!0},getParentId:function(n){var e=void 0;for(var r in this.originalTree)this.originalTree[r].id==n&&(e=this.originalTree[r].parentId);return e},getRoleTree:function(n){var e=this;this.loading=!0;var r=this.$api.rolePermission;s.a.get(r+"/"+n).then(function(n){if(e.loading=!1,"0"==n.data.errorCode){if(e.originalTree=n.data.data,"update"==e.page){e.checkStrict=!0;for(var r=0;r<e.originalTree.length;r++)1==e.originalTree[r].checked&&(e.checkedTree.push(e.originalTree[r].id),e.checkedUri.push(e.originalTree[r].uri))}e.setTree(n.data.data,function(){e.setChildTree()})}else n.data.errorMessage?e.errorMessage(n.data.errorMessage):e.errorMessage("请求失败")}).catch(function(n){e.loading=!1})},setChildTree:function(){for(var n=this,e=0;e<this.originalTree.length;e++)for(var r in this.treeListParent)this.treeListParent[r].id==this.originalTree[e].parentId&&this.treeListParent[r].childrenNodes.push(this.originalTree[e]);setTimeout(function(){n.role.showTree=!0,n.checkStrict=!1},0)},setTree:function(n,e){for(var r=0;r<n.length;r++)n[r].childrenNodes=[],null==n[r].parentId&&this.treeListParent.push(n[r]);e()},next:function(){var n=this;if("update"==this.page);else{var e=this.$api.roleSave;s.a.post(e,this.dataInfo).then(function(e){n.loading=!1,"0"==e.data.errorCode?(n.role.newRoleId=e.data.data.id,n.getRoleTree(n.role.newRoleId)):(n.role.newRoleId=null,n.role.showTree=!1,e.data.errorMessage?n.errorMessage(e.data.errorMessage):n.errorMessage("操作失败"))}).catch(function(e){n.loading=!1})}},saveRole:function(n){var e=this,r=this.$api.setRolePermission,t=escape(this.chosenTreeIds.join(","));s.a.put(r+"/"+this.role.newRoleId+"?adduris="+t).then(function(r){e.loading=!1,"0"==r.data.errorCode?n?(e.reset(),e.role.showTree=!1,e.firstLevel=[]):(e.successMessage("操作成功"),setTimeout(function(){e.routerLink("/role/list")},1e3)):r.data.errorMessage?e.errorMessage(r.data.errorMessage):e.errorMessage("操作失败")}).catch(function(n){e.loading=!1})}},created:function(){var n=this.$route.query.id,e=this.$route.query.type;this.updateId=n,"update"==e&&(this.page="update",this.getDataInfo(n),this.getRoleTree(n))}},l=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("section",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"cms-body"},[r("cms-back"),n._v(" "),r("el-form",{ref:"form",staticClass:"cms-form",attrs:{model:n.dataInfo,rules:n.rules,"label-width":"162px"}},[r("el-form-item",{staticClass:"flex-50",attrs:{label:"角色名",prop:"name"}},[r("el-input",{staticClass:"cms-width",model:{value:n.dataInfo.name,callback:function(e){n.$set(n.dataInfo,"name",e)},expression:"dataInfo.name"}})],1),n._v(" "),r("div",{staticClass:"form-footer"},["update"!=n.page?r("el-button",{directives:[{name:"perms",rawName:"v-perms",value:"/role/save",expression:"'/role/save'"}],attrs:{type:"primary"},on:{click:n.next}},[n._v("下一步")]):n._e()],1),n._v(" "),n.role.showTree&&"update"!=n.page?r("el-form-item",{staticClass:"flex-100",attrs:{label:"选择权限树新建"}},[r("el-tree",{ref:"addTree",attrs:{props:n.props2,load:n.ansyTree,lazy:"",indent:16,"node-key":"props.id","default-expanded-keys":[""],"default-checked-keys":[""],"show-checkbox":"","check-strictly":n.checkStrict},scopedSlots:n._u([{key:"default",fn:function(e){var t=e.node;e.data;return r("span",{staticClass:"custom-tree-node"},[r("span",{attrs:{title:t.label}},[n._v(n._s(t.label))])])}}])})],1):n._e(),n._v(" "),n.role.showTree&&"update"==n.page?r("el-form-item",{staticClass:"flex-100",attrs:{label:"选择权限树编辑"}},[r("el-tree",{ref:"tree",attrs:{props:n.props2,load:n.ansyTree,lazy:"",indent:16,"default-checked-keys":n.checkedTree,"node-key":"id","default-expanded-keys":[""],"show-checkbox":"","check-strictly":n.checkStrict},on:{"node-expand":n.nodeExpand},scopedSlots:n._u([{key:"default",fn:function(e){var t=e.node;e.data;return r("span",{staticClass:"custom-tree-node"},[r("span",{attrs:{title:t.label}},[n._v(n._s(t.label))])])}}])})],1):n._e(),n._v(" "),n.role.showTree?r("div",{staticClass:"form-footer"},[n.isType("save")?r("el-button",{directives:[{name:"perms",rawName:"v-perms",value:"/role/save",expression:"'/role/save'"}],attrs:{type:"warning"},on:{click:function(e){n.add(!0)}}},[n._v("保存并继续添加")]):n._e(),n._v(" "),n.isType("save")?r("el-button",{directives:[{name:"perms",rawName:"v-perms",value:"/role/save",expression:"'/role/save'"}],attrs:{type:"primary"},on:{click:function(e){n.add(!1)}}},[n._v("提交")]):n._e(),n._v(" "),n.isType("update")?r("el-button",{directives:[{name:"perms",rawName:"v-perms",value:"/role/update",expression:"'/role/update'"}],attrs:{type:"primary"},on:{click:function(e){n.update()}}},[n._v("修改")]):n._e(),n._v(" "),r("el-button",{attrs:{type:"info"},on:{click:n.reset}},[n._v("重置")])],1):n._e()],1)],1)},d=[],h={render:l,staticRenderFns:d},c=h,u=r("VU/8"),f=t,p=u(o,c,!1,f,null,null);e.default=p.exports},OQeP:function(n,e,r){var t=r("oPiu");"string"==typeof t&&(t=[[n.i,t,""]]),t.locals&&(n.exports=t.locals);r("rjj0")("6d6b76e4",t,!0,{})},oPiu:function(n,e,r){e=n.exports=r("FZ+f")(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}});